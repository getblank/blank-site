<!DOCTYPE html>
<html class="no-js" lang="ru-RU" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport"> 
    <meta name="generator" content="Hugo 0.79.0" />

    
        <meta name="description" content="Облачная платформа для создания бэкенда с открытым исходным кодом">
    

    
        <meta name="keywords" content="BaaS, backend, cloud, iot, platform, бэкенд, облачный сервис, интернет вещей">
    

    <meta name="author" content="BLANK">


    <base href="https://getblank.github.io/site/">

    
    <title>Lifecycle events &middot; BLANK cloud platform</title>
    

    <link rel="canonical" href="https://getblank.github.io/site/doc/lifecycle_events/">
    <link rel="shortcut icon" href="/site/img/favicon.ico" />
    <link href='https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900' rel='stylesheet' type='text/css'>
<link href="/site/css/app.css" media="all" rel="stylesheet"/>
<link href="/site/css/hl-github.css" rel="stylesheet">
</head>

<body lang="ru">
 <script type="text/javascript" > (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(34002915, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true }); </script> <noscript><div><img src="https://mc.yandex.ru/watch/34002915" style="position:absolute; left:-9999px;" alt="" /></div></noscript> 

<div id="navbar"  class="no-expand blog"  >
    <div class="container">
        <a href="#" data-menu="sidenav" class="nav-toggle menu">
            <img src="/site/img/menu.svg" alt="menu"/>
        </a>
        <div class="logo">
            <a href="index.html" class="nav-link">BLANK</a>
        </div>
        <ul class="nav collapse" id="nav">
            <li>
                <a href="/site/doc/introduction/" class="nav-link index-link active">
                    Документация
                </a>
            </li>
            <li>
                <a href="#contacts" class="nav-link index-link" data-active-until="contacts-end" data-active-after="contacts-start">
                    Контакты
                </a>
            </li>
            <li>
                <a href="https://github.com/getblank/" class="nav-link">
                    <img src="img/GitHub-Mark-Light-32px.png" style="width: 14px; height: 14px; position: relative; top: 1px" border="0">
                    GitHub
                </a>
            </li>
        </ul>
    </div>
</div>

<div id="docs">
  <div class="docs-contents">
    
    
    
      <h3>Начало работы</h3>
    
      
        <ul>
          
            <li >
              <a href="/site/doc/introduction/">Вступление</a>
            </li>
          
            <li >
              <a href="/site/doc/quickstart/">Быстрый старт</a>
            </li>
          
            <li >
              <a href="/site/doc/settings/">Конфигурация</a>
            </li>
          
        </ul>
        <hr/>
      
    
    
      <h3>Blank CLI</h3>
    
      
        <ul>
          
            <li >
              <a href="/site/doc/cli/">CLI reference</a>
            </li>
          
            <li >
              <a href="/site/doc/build/">Сборка конфигурации</a>
            </li>
          
        </ul>
        <hr/>
      
    
    
      <h3>Blank Schema</h3>
    
      
        <ul>
          
            <li >
              <a href="/site/doc/schema/">Описание</a>
            </li>
          
            <li >
              <a href="/site/doc/stores/">Stores</a>
            </li>
          
            <li >
              <a href="/site/doc/store_reference/">Store reference</a>
            </li>
          
            <li >
              <a href="/site/doc/store-displaying/">Store displaying</a>
            </li>
          
            <li >
              <a href="/site/doc/props_reference/">Props reference</a>
            </li>
          
            <li >
              <a href="/site/doc/props-modeling/">Props modeling</a>
            </li>
          
            <li >
              <a href="/site/doc/props-displaying/">Props displaying</a>
            </li>
          
            <li >
              <a href="/site/doc/access/">Access control</a>
            </li>
          
            <li >
              <a href="/site/doc/filters/">Filters</a>
            </li>
          
            <li >
              <a href="/site/doc/httphooks/">HTTP hooks</a>
            </li>
          
            <li  class="active">
              <a href="/site/doc/lifecycle_events/">Lifecycle events</a>
            </li>
          
        </ul>
        <hr/>
      
    
    
      <h3>Serverside JS API</h3>
    
      
        <ul>
          
            <li >
              <a href="doc/serverjs/">Описание</a>
            </li>
          
            <li >
              <a href="doc/actions/">Actions</a>
            </li>
          
            <li >
              <a href="doc/db">$db</a>
            </li>
          
            <li >
              <a href="doc/request/">$request</a>
            </li>
          
            <li >
              <a href="doc/email/">Email</a>
            </li>
          
            <li >
              <a href="doc/files/">Files</a>
            </li>
          
            <li >
              <a href="doc/fs/">FS</a>
            </li>
          
            <li >
              <a href="doc/i18n/">I18n</a>
            </li>
          
            <li >
              <a href="doc/queue/">Queue</a>
            </li>
          
        </ul>
        <hr/>
      
    
    
      <h3>HTTP API</h3>
    
      
        <ul>
          
            <li >
              <a href="/site/doc/httprest/">REST</a>
            </li>
          
            <li >
              <a href="/site/doc/httpauth/">Auth</a>
            </li>
          
        </ul>
        <hr/>
      
    
    
      <h3>Интеграция</h3>
    
      
        <ul>
          
            <li >
              <a href="/site/doc/facebook/">Facebook</a>
            </li>
          
        </ul>
        <hr/>
      
    

  </div>
  <div class="doc-wrapper">
    <div class="doc">
      <h1>Lifecycle events</h1>
      <div class="content">
        <h2 id="objectlifecycle">ObjectLifeCycle</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;objectLifeCycle&#34;</span><span style="color:#000;font-weight:bold">:</span> {
    <span style="color:#d14">&#34;eventName&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> () {}
},
</code></pre></div><p>Обработчики событий, происходящих с объектами в Store.</p>
<h3 id="willcreate">willCreate</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;willCreate&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> ($item, $user)<span style="color:#000;font-weight:bold">:</span><span style="color:#0086b3">Promise</span> {}
</code></pre></div><p>Выполняется непосредственно перед созданием нового объекта, но до проведения валидации.
Используйте этот обработчик как возможность модифицировать объект перед созданием или провести
дополнительную валидацию и прервать эту операцию.</p>
<p><code>$item</code> является ссылкой на сохраняемый объект. Все изменения, сделанные в <code>$item</code>, будут сохранены в БД.</p>
<p>Если обработчик возвращает Promise, платформа будет ожидать его resolve/reject.</p>
<p>Если обработчик выбрасывает исключение или происходит reject возвращенного Promise, создание объекта
будет отменено.</p>
<p>Для отправки сообщения об ошибке исключение (или объект ошибки Promise)
должно быть экземпляром класса UserError. В других случаях сервер вернет &ldquo;500. Internal server error&rdquo;.</p>
<h3 id="didcreate">didCreate</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;didCreate&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> ($item, $user) {}
</code></pre></div><p>Выполняется сразу после создания объекта. Изменения в $item уже ни на что не повлияют. Можно использовать
этот обработчик для добавления какой-либо бизнес-логики по синхронизации данных или вызова внешнего API.</p>
<h3 id="willsave">willSave</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;willSave&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> ($item, $prevItem, $user)<span style="color:#000;font-weight:bold">:</span><span style="color:#0086b3">Promise</span> {}
</code></pre></div><p>Выполняется непосредственно перед сохранением объекта, но до проведения валидации. Не выполняется перед
созданием объекта, для этого используйте обработчик <a href="/site/doc/lifecycle_events/#willcreate">didCreate</a>.
Используйте этот обработчик как возможность модифицировать объект перед сохранением или провести
дополнительную валидацию и прервать сохранение.</p>
<p><code>$item</code> является ссылкой на сохраняемый объект. Все изменения, сделанные в <code>$item</code>, будут сохранены в БД.</p>
<p>Если обработчик возвращает Promise, платформа будет ожидать его resolve/reject.</p>
<p>Если обработчик выбрасывает исключение или происходит reject возвращенного Promise, сохранение объекта
будет отменено.</p>
<p>Для отправки сообщения об ошибке исключение (или объект ошибки Promise)
должно быть экземпляром класса UserError. В других случаях сервер вернет &ldquo;500. Internal server error&rdquo;.</p>
<h3 id="didsave">didSave</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;didSave&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> ($item, $prevItem, $user) {}
</code></pre></div><p>Выполняется сразу после сохранения объекта. Изменения в $item уже ни на что не повлияют. Можно использовать
этот обработчик для добавления какой-либо бизнес-логики по синхронизации данных или вызова внешнего API.</p>
<h3 id="willremove">willRemove</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;willRemove&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> ($item, $user)<span style="color:#000;font-weight:bold">:</span><span style="color:#0086b3">Promise</span> {}
</code></pre></div><p>Выполняется непосредственно перед удалением объекта.</p>
<p>Если обработчик возвращает Promise, платформа будет ожидать его resolve/reject.</p>
<p>Если обработчик выбрасывает исключение или происходит reject возвращенного Promise, объект не будет удалён.</p>
<p>Для отправки сообщения об ошибке исключение (или объект ошибки Promise)
должно быть экземпляром класса UserError. В других случаях сервер вернет &ldquo;500. Internal server error&rdquo;.</p>
<h3 id="didremove">didRemove</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;didRemove&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> ($item, $user) {}
</code></pre></div><p>Выполняется сразу после удаления объекта.</p>
<h2 id="storelifecycle">StoreLifeCycle</h2>
<h3 id="didstart">didStart</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;didStart&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> () {}
</code></pre></div><p>Выполняется при старте воркера. Можно использовать для подготовки данных или их проверки после рестарта.
!Внимание! Обработчик выполняется на всех воркерах, для выполнения обработчика один раз следует использовать
инструменты синхронизации:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#d14">&#34;didStart&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> () {
    sync.once(<span style="color:#d14">&#34;myStoreDidStart&#34;</span>, () =&gt; {
        <span style="color:#998;font-style:italic">//Этот код выполнится один раз
</span><span style="color:#998;font-style:italic"></span>    });
}
</code></pre></div>
      </div>
    </div>
  </div>
  <div class="clear"></div>
</div>

<footer id="contacts">
  <div id="contacts-start"></div>
  <div>
    <p>2020 &copy; Blank</p>
    <p>Телефон: +7 (922) 477-26-60</p>
    <p>E-mail: info+blank@sclif.pro</p>
    <p style="font-size: .8rem">Россия &middot; Тюмень</p>
    <p class="hugo">Site powered by <a href="http://gohugo.io">Hugo</a></p>
  </div>
  <div id="contacts-end"></div>
</footer>
<div id="lightbox" class="hidden">
  <div class="back"></div>
  <div class="close"></div>
  <div class="image">
    <img src="" alt="" />
  </div>
</div>
<script type="text/javascript" src="app.bundle.js"></script>
<script src="/site/js/highlight.pack.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
</body>

</html>